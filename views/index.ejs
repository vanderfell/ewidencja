<%
const currentYear = new Date().getFullYear();
const monthNames  = ['stycze≈Ñ','luty','marzec','kwiecie≈Ñ','maj','czerwiec',
                     'lipiec','sierpie≈Ñ','wrzesie≈Ñ','pa≈∫dziernik','listopad','grudzie≈Ñ'];
%>

<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8"/>
  <title>Ewidencja czasu pracy</title>
  <link rel="stylesheet" href="/css/main.css">
</head>
<body>
  <header class="app-header">
    <div class="header-content">
      <div class="logo">üóÇÔ∏è</div>
      <h1 class="app-title">EWP¬†0.1205</h1>
      <div class="header-meta"><%= year %> / <%= monthNames[month-1] %></div>

    </div>
  </header>

  <!-- G≈Å√ìWNE ZAK≈ÅADKI -->
  <ul class="tabs">
    <li class="tab active" data-tab="overview">Obs≈Çuga</li>
    <li class="tab"        data-tab="teachers">Nauczyciele</li>
    <li class="tab"        data-tab="employees">Pracownicy</li>
    <li class="tab"        data-tab="settings">Ustawienia</li>
  </ul>

  <!-- ============ OBS≈ÅUGA ============ -->
  <div id="overview" class="tab-content active">
    <!-- subtabs -->
    <ul class="subtabs">
      <li class="subtab active" data-subtab="overview-table">Ewidencja</li>
      <li class="subtab"        data-subtab="kw-tab">Zestawienie¬†kwartalne</li>
      <% emps.filter(e=>e.department==='Obs≈Çuga').forEach(emp=>{ %>
        <li class="subtab" data-subtab="card-<%= emp.id %>"><%= emp.full_name %></li>
      <% }) %>
    </ul>

    <!-- tre≈õƒá -->
    <div id="overview-table" class="subtab-content active">
      <%- include('partials/calendar_table', {
      employees: emps.filter(e=>e.department==='Obs≈Çuga'),
      dayInfos:  dayInfosObs,
      wds, summary, CODE_COLORS,
      year, month, currentYear, monthNames
    })
%>
    </div>

    <div id="kw-tab" class="subtab-content"><!-- ≈Çadowane AJAX‚Äëem --></div>

    <% emps.filter(e=>e.department==='Obs≈Çuga').forEach(emp=>{ %>
      <div id="card-<%= emp.id %>" class="subtab-content"></div>
    <% }) %>
  </div>

<!-- ======== NAUCZYCIELE ======== -->
<div id="teachers" class="tab-content">
  <ul class="subtabs">
    <li class="subtab active" data-subtab="teachers-table">Nieobecno≈õci</li>
    <li class="subtab"        data-subtab="teachers-subst">Zastƒôpstwa</li>
    
  </ul>

  <!-- Ewidencja (teacher_presence) -->
  <div id="teachers-table" class="subtab-content active">
    <%- include('partials/calendar_table', {
          employees:            emps.filter(e=>e.department==='Nauczyciel'),
          dayInfos:             dayInfosTea,
          wds:                   teacherPresenceRecords,
          summary:               presSummary,
          CODE_COLORS, year, month, currentYear, monthNames
        }) %>
  </div>

  <!-- Nieobecno≈õci (workdays) -->
  <div id="teachers-absence" class="subtab-content">
    <%- include('partials/absence_table', {
          employees:    emps.filter(e=>e.department==='Nauczyciel'),
          wds,
          CODE_COLORS, year, month
        }) %>
  </div>

  <!-- Zastƒôpstwa (teacher_substitutions) -->
  <div id="teachers-subst" class="subtab-content">
    <%- include('partials/substitution_table', {
        employees: emps.filter(e=>e.department==='Nauczyciel'),
        dayInfos:   dayInfosTea,
        wds, summary,
        year, month
    }) %>
  </div>

</div>



  <!-- ============ PRACOWNICY ============ -->
  <div id="employees" class="tab-content">
    <div id="employees-container"><!-- profile_menu.ejs --></div>
  </div>

  <!-- ======== USTAWIENIA ======== -->
  <%- include('settings') %>

  <!-- CONTEXT MENUS -->
  <ul id="emp-context-menu">
    <li id="ctx-profile">Wy≈õwietl profil‚Ä¶</li>
    <li id="ctx-edit">Edytuj pracownika‚Ä¶</li>
    <li id="ctx-note">Notatka</li>
    <li id="ctx-delete">Usu≈Ñ pracownika</li>
  </ul>
  <ul id="day-context-menu">
    <li data-code="≈ö">≈ö ‚Äì ≈öwiƒôto</li>
    <li data-code="P">P ‚Äì Dzie≈Ñ roboczy</li>
    <li data-code="-">‚Äì ‚Äì Weekend</li>
    <li data-code="DW">DW ‚Äì Dzie≈Ñ wolny</li>
    <li data-code="">Usu≈Ñ nadpisanie</li>
  </ul>

  <!-- MODAL EDIT -->
  <div id="emp-modal">
    <div class="modal-content">
      <h2>Edytuj pracownika</h2>
      <form id="emp-edit-form">
        <label>Imiƒô i nazwisko:<br><input name="full_name" required/></label>
        <label>Stanowisko:<br><input name="position"/></label>
        <label>Numer ewidencyjny:<br><input name="payroll_number"/></label>
        <label>Norma dzienna (h):<br><input type="number" name="daily_norm" step="0.25" required/></label>
        <label>Dzia≈Ç:<br>
          <select name="department" required>
            <option value="Obs≈Çuga">Obs≈Çuga</option>
            <option value="Nauczyciel">Nauczyciel</option>
          </select>
        </label>
        <div class="modal-buttons">
          <button type="button" id="modal-cancel">Anuluj</button>
          <button type="submit">Zapisz</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- MODAL: Notatka -->
  <div id="note-modal" style="display:none; position:fixed; top:0; left:0;
                              width:100%; height:100%; background:rgba(0,0,0,0.5);
                              align-items:center; justify-content:center; z-index:1002;">
    <div class="modal-content" style="background:#fff; padding:1em; border-radius:4px;
                                       width:auto; max-width:90%; max-height:90%; overflow:auto;">
      <h2>Notatka</h2>
      <textarea id="note-text" style="width:400px; height:400px; margin-top:0.5em;"></textarea>
      <div class="modal-buttons" style="margin-top:1em; text-align:right;">
        <button type="button" id="note-cancel">Anuluj</button>
        <button type="button" id="note-delete" style="margin-right:0.5em;">Usu≈Ñ</button>
        <button type="button" id="note-save">Zapisz</button>
      </div>
    </div>
  </div>

  <script>window.CODE_COLORS=<%- JSON.stringify(CODE_COLORS) %>;</script>
  <script>window.YEAR=<%=year%>; window.MONTH=<%=month%>;</script>
  <script src="/script.js"></script>
</body>
</html>
